import pandas as pd
import matplotlib.pyplot as plt

def generate_overall_plot(platform, y_offset):
    data = pd.read_csv("../data/exploit_detailed/" + platform + "/overall_rankings")
    df = pd.DataFrame(data)
    
    x = list(df.iloc[:, 0])
    y = list(df.iloc[:, 1])

    plt.bar(x, y, color="#00bc79")
    plt.title("Overall ranking of all exploit modules for " + platform + " platform")
    plt.xlabel("Rank")
    plt.ylabel("Number of modules")

    plt.xticks(rotation=45)

    for index,data in enumerate(y):
        plt.text(x=index-0.4, y=data+y_offset, s=f"{data}", fontdict=dict(fontsize=10))
    
    plt.tight_layout()
    plt.savefig("exploit_detailed/" + platform + "/overall_ranking.png")

def generate_targets_plot(platform, y_offset, x_offset=0):
    data = pd.read_csv("../data/exploit_detailed/" + platform + "/overall_platforms")
    df = pd.DataFrame(data)
    
    x = list(df.iloc[:, 0])
    y = list(df.iloc[:, 1])
    
    if platform == "multi":
        plt.figure(figsize=(10, 6))
    elif platform == "windows":
        plt.figure(figsize=(20, 6))

    plt.bar(x, y, color="#00bc79")


    plt.title("Overall number of exploit modules for different targets\nfor " + platform + " platform")
    plt.xlabel("Platform")
    plt.ylabel("Number of modules")

    plt.xticks(rotation=45)

    for index,data in enumerate(y):
        plt.text(x=index-0.5+x_offset, y=data+y_offset, s=f"{data}", fontdict=dict(fontsize=10))
    
    plt.tight_layout()
    plt.savefig("exploit_detailed/" + platform + "/overall_targets.png")
    plt.figure()

if __name__ == "__main__":
    generate_overall_plot("linux", 2)
    plt.clf()
    generate_targets_plot("linux", 1)
    plt.clf()

    generate_overall_plot("multi", 1)
    plt.clf()
    generate_targets_plot("multi", 1)
    plt.clf()

    generate_overall_plot("unix", 1)
    plt.clf()
    generate_targets_plot("unix", 0.5, 0.05)
    plt.clf()

    generate_overall_plot("windows", 2)
    plt.clf()
    generate_targets_plot("windows", 2)
